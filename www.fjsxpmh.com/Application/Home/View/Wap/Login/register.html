<include file="Common:meta" />
<title>注册-{$site.SITE_INFO.title}</title>
<meta name="description" content="{$site.SITE_INFO.keyword}">
<meta name="keywords" content="{$site.SITE_INFO.description}">
<include file="Common:link" />
<body>
	<nav class="on-common-menu"> 
        <ul class="am-avg-sm-2">
            <li class="on-mli <eq name='ACTION_NAME' value='index'>on-active</eq>">
                <a href="{:U('Login/index',array('gol'=>$gol,'openid'=>$openid,'access_token'=>$access_token,'suname'=>$suname,'bound'=>$bound))}">登陆</a>
            </li>
            <li class="on-mli <eq name='ACTION_NAME' value='register'>on-active</eq>">
                <a href="{:U('Login/register',array('gol'=>$gol,'openid'=>$openid,'access_token'=>$access_token,'suname'=>$suname,'bound'=>$bound))}">新用户注册</a>
            </li>
        </ul>
    </nav>
    <!-- 主题部分【 -->
	<empty name="registerType">
		<div class="frame_tit">
			网站已暂停用户注册！请和管理员联系
		</div>
	<else/>
		<ul class="tabMenu am-avg-sm-3">
		    <li class="on-mli <eq name="registerType" value="account">on</eq>">
	            <a href="{:U('Login/register',array('gol'=>$gol,'openid'=>$openid,'access_token'=>$access_token,'suname'=>$suname,'bound'=>$bound))}">账号注册</a>
	        </li>
	        <li class="on-mli <eq name="registerType" value="email">on</eq>">
	            <a style="border-left: 1px solid #f1f1f1; border-right: 1px solid #f1f1f1;" href="{:U('Login/register',array('gol'=>$gol,'registerType'=>'email','openid'=>$openid,'access_token'=>$access_token,'suname'=>$suname,'bound'=>$bound))}">邮箱注册</a>
	        </li>
	        <li class="on-mli <eq name="registerType" value="mobile">on</eq>">
	            <a href="{:U('Login/register',array('gol'=>$gol,'registerType'=>'mobile','openid'=>$openid,'access_token'=>$access_token,'suname'=>$suname,'bound'=>$bound))}">手机注册</a>
	        </li>
		</ul>
		<div class="frame_tit">欢迎注册{$site.SITE_INFO.name}</div>
	</empty>
    <form id="RegForm" class="reg-form am-form" name="register" method="post">
		<eq name="registerType" value="account"> 
			<!-- 账号注册 -->
			 <dl class="user-frame">
				 <dd><input class="input" id="account" name="account" placeholder="账号" type="text" class="input"/></dd>
				 <dd><div id="accountTip"></div></dd>
			 </dl>
			 <empty name="openid">
				 <dl class="user-frame">
					 <dd><input class="input" id="nickname" name="nickname" placeholder="昵称" type="text" class="input"/></dd>
					 <dd><div id="nicknameTip"></div></dd>
				 </dl>
			 </empty>
			 <dl class="user-frame">
				 <dd><input class="input" id="truename" name="truename"  placeholder="真实姓名" type="text" class="input"/></dd>
				 <dd><div id="truenameTip"></div></dd>  
			 </dl>
			 <empty name="openid">
				 <dl class="user-frame">
		            <dd><input class="input" id="mobile" type="number" placeholder="手机号" class="input" name="mobile" value="{$my_info.mobile}"/></dd>
		            <dd><div id="mobileTip"></div></dd> 
		         </dl>
	         </empty>
	         <input type="hidden" name="registerType" value="account">
		</eq>
		<!-- 账号注册——end -->
		<!-- 邮箱注册表单 -->
		<eq name="registerType" value="email">
			 <dl class="user-frame">
				 <dd>
				 	<input class="input scode" id="email" name="email" placeholder="邮箱" type="text" class="input" value="{$email}" />
				 </dd>
				 <dd><div id="emailTip"></div></dd>
			 </dl>

			 <dl class="user-frame">
				 <dd>
				 	<input type="button" checktp="email" class="am-btn am-btn-danger am-radius checkbtnto" value="发送验证码">
				 </dd>
			 </dl>
			 <dl class="user-frame">
				 <dd><input class="input" id="email_verify" placeholder="邮箱验证码" name="email_verify" type="text" class="input" value="" /></dd>
				 <dd><div id="email_verifyTip"></div></dd>
			 </dl>
			 <empty name="openid">
				 <dl class="user-frame">
					 <dd><input class="input" id="nickname" name="nickname" placeholder="昵称" type="text" class="input"/></dd>
					 <dd><div id="nicknameTip"></div></dd>
				 </dl>
			 </empty>
			 <dl class="user-frame">
				 <dd><input class="input" id="truename" name="truename" placeholder="真实姓名" type="text" class="input"/></dd>
				 <dd><div id="truenameTip"></div></dd>
			 </dl>
			 <empty name="openid">
				 <dl class="user-frame">
		            <dd><input class="input" id="mobile" type="number" placeholder="手机号码" class="input" name="mobile" value="{$my_info.mobile}"/></dd>
		            <dd><div id="mobileTip"></div></dd>
		         </dl>
	         </empty>
	         <input type="hidden" name="registerType" value="email">
		</eq>
		<!-- 邮箱注册表单——end -->
		<!-- 手机注册表单 -->
		<eq name="registerType" value="mobile">
			 <dl class="user-frame">
				 <dd>
				 	<input class="input scode" placeholder="手机号码" id="mobile" name="mobile" type="number" value="" />
				 </dd>
				 <dd><div id="mobileTip"></div></dd>
			 </dl>
			 <dl class="user-frame">
				 <dd>
					<input type="button" checktp="mobile" class="am-btn am-btn-danger am-radius checkbtnto" value="发送验证码">
				 </dd>
			 </dl>
			 <dl class="user-frame">
				 <dd><input placeholder="手机验证码" id="mobile_verify" name="mobile_verify" type="number" class="input" value="" /></dd>
				 <dd><div id="mobile_verifyTip"></div></dd>
			 </dl>
			 <empty name="openid">
				 <dl class="user-frame">
					 <dd><input class="input" id="nickname" name="nickname" placeholder="昵称" type="text" class="input"/></dd>
					 <dd><div id="nicknameTip"></div></dd>
				 </dl>
			 </empty>
			 <dl class="user-frame">
				 <dd><input placeholder="真实姓名" id="truename" name="truename" type="text" class="input"/></dd>
				 <dd><div id="truenameTip"></div></dd>       
			 </dl>
			 <empty name="openid">
				 <dl class="user-frame">
	                <dd><input placeholder="邮箱" id="email" type="text" class="input" name="email"/></dd>
					<dd><div id="emailTip"></div></dd>
	             </dl>
             </empty>
			<input type="hidden" name="registerType" value="mobile">
		</eq>
		<notempty name="registerType">
			<dl class="user-frame">
				 <dd><input class="input" id="pwd" name="pwd" placeholder="登陆密码" type="password" class="input" /></dd>
				 <dd><div id="pwdTip"></div></dd> 
			 </dl>
			 <dl class="user-frame">
				<dd><input class="input" id="pwded" name="pwded" placeholder="确认密码" type="password" class="input" /></dd>
				<dd><div id="pwdedTip"></div></dd> 
			 </dl>
			 <neq name="iswei" value="1">
			 	<dl class="user-frame">
				 	<dd class="am-cf">
					 	<input class="input vcode" class="input" id="verify_code" name="verify_code" type="number" placeholder="验证码" />
					 	<img class="verify_img" src="{:U('Public/verify_code')}"  title="看不清？单击此处刷新" onclick="this.src+='?rand='+Math.random();" />
				 	</dd>
				 	<dd><div id="verify_codeTip"></div></dd>
				 </dl>
			 </neq>
			 
	        <!-- 微信端打开显示【 -->
	        <notempty name="openid">
	            <dl class="user-frame">
	            	<eq name="bound" value="checked">
		                <label class="am-checkbox am-danger am-margin-0">
		                    <input name="bound" type="checkbox" value="1" data-am-ucheck checked> 绑定当前微信
		                </label>
		            </eq>
	                <label class="am-checkbox am-danger am-margin-0">
	                  <input name="weiauto" type="checkbox" value="1" data-am-ucheck checked> 今后自动登陆
	                </label>
	                <label class="am-checkbox am-danger am-margin-0">
	                  <input name="alertadd" type="checkbox" value="1" data-am-ucheck checked> 接收服务号消息提醒
	                </label>
	            </dl>
	            <input  type="hidden" name="openid" value="{$openid}" />
	            <input  type="hidden" name="access_token" value="{$access_token}" />
	        </notempty>
	        <!-- 微信端打开显示】 -->
			 <notempty name="feedback">
			 <dl class="user-frame">
				<dd class="feedback">
					<div class="tit">您是通过什么途径了解到{$site.SITE_INFO.name}的?</div>
					<div class="clearfix">
						<volist name="feedback" id="vo">
							<label class="am-radio am-secondary">
							  <input type="radio" name="feedback" value="{$vo.id}" data-am-ucheck> {$vo.name}
							</label>
						</volist>
					</div>
				</dd>
			 </dl>
			 </notempty>
			 <dl class="user-frame">
			   <dd class="xieyi">
					<label class="am-checkbox am-danger am-margin-0">
	                  <input name="isAgree" type="checkbox" id="isAgree" value="1" data-am-ucheck checked> 我已阅读并接受<a href="{:U('Public/information')}" >《{$site.SITE_INFO.name}服务协议》</a>
	                </label>
	                <span class="text"></span><span id="clauseTips"></span>
			   </dd>
			   <dd><div id="isAgreeTip"></div></dd>
			   <input  type="hidden" name="referer" value="{$referer}" />
			   <input  type="hidden" name="suname" value="{$suname}" />
			</dl>
			 <dl>
				<dd>
					<input class="submitBtn am-btn am-btn-danger am-radius" type="submit" value='马上注册' id='submit'/>
				</dd>
			</dl>
		</notempty>
	<!-- 手机注册表单——end -->
	<div class="lgorrg clearfix">
		<span class="fl">已有账号？</span>
		<a class="fl" href="{:U('Login/index')}">登陆</a>
	</div>

    <!-- 主题部分】 -->
<!---底部开始-->
<include file="Common:footer"/>
<include file="Common:navbar"/>
</body>
<js href="--PUBLIC--/Js/formValidator/formValidator-4.1.3.js"/>
<js href="--PUBLIC--/Js/formValidator/formValidatorRegex.js"/>

<script type="text/javascript">
var checkAccount = "{:U('Login/checkAccount','',true)}";
var checkMobile = "{:U('Login/checkMobile','',true)}";
var checkEmail = "{:U('Login/checkEmail','',true)}";
var checkVerify = "{:U('Login/checkVerify','',true)}";
var checkEmailCode = "{:U('Login/checkEmailCode','',true)}";
var checkMobileCode = "{:U('Login/checkMobileCode','',true)}";

var sendCodeUlrl = "{:U('Login/sendCode','',true)}";
var wait=60;
    $(function(){
    	// 重新发送验证码
    	$('.checkbtnto').click(function(){
    		popStatus(3, '发送中...', 0,'',true);
    		var checkadr = $('#'+$(this).attr('checktp')).val();
			var checktp = $(this).attr('checktp');
			$.post(sendCodeUlrl,{'checkadr':checkadr,'checktp':checktp,'how':'register'},function(data){
				popStatusOff();
                if (data.status) {
                    popup.success(data.info);
                    setTimeout(function(){
                        popup.close("asyncbox_success");
                    },2000);
                    $('.checkadrbox input').attr("disabled", 'disabled');
                    time($('.checkbtnto'));
                } else {
                    popup.error(data.info);
                    setTimeout(function(){
                        popup.close("asyncbox_error");
                    },2000);
                }
            },'json');
        });
        // 重新发送验证码】
	// 表单验证【
	$.formValidator.initConfig({formID:"RegForm",submitButtonID:"submit"});
	$("#submit").click(function(){
        if($.formValidator.pageIsValid('1')==true){
        	var pushstr = '';
        	if($('input:checkbox[name="bound"]:checked').val()==1){
                pushstr = '绑定微信';
            }
        	popStatus(3, '提交注册'+pushstr+'中，请等待...', 0,'',true);
            commonAjaxSubmit('','','',function(){
                var newcode = $('.verify').attr('src');
                $('.verify').attr('src',newcode+'?rand='+Math.random());
                $('#verify_code').val('');
            });
        }
        return false;
    });


	$("#account").formValidator({onShow:"请输入用账号",onFocus:"以字母开头，5-17 字母、数字、下划线'_'",onCorrect:"该用账号可以注册"}).inputValidator({min:5,max:17,onError:"你输入的用账号不正确,请确认"}).functionValidator({fun:formAccount}).ajaxValidator({
			url : checkAccount,
			type : 'POST',
			dataType : "json",
			data : "&account="+$('#account').val(), 
			async : true,
			success : function(data){
				if(data){
					return true;
				}else{
					return false;
				}
			},
			buttons: $("#button"),
			error: function(jqXHR, textStatus, errorThrown){alert("服务器没有返回数据，可能服务器忙，请重试"+errorThrown);},
			onError : "该用账号已被注册，请更换用账号",
			onWait : "正在对用账号进行合法性校验，请稍候..."
		});
	$("#nickname").formValidator({onShow:"你在这里的名字",onFocus:"昵称，要求最少3个不超过20个字符(一个汉字占用2个字符)",onCorrect:"输入正确"}).inputValidator({min:3,max:20,onError:"你输入的昵称不正确,请确认"});
	$("#truename").formValidator({onShow:"请输入你的中文姓名",onFocus:"要求2-10个中文字符",onCorrect:"输入正确"}).functionValidator({fun:trueName});
	$("#email").formValidator({onShow:"请输入邮箱",onFocus:"邮箱6-100个字符",onCorrect:"输入正确",defaultValue:"@"}).inputValidator({min:6,max:100,onError:"你输入的邮箱长度不正确,请确认"}).regexValidator({regExp:"^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$",onError:"你输入的邮箱格式不正确"}).ajaxValidator({
			url : checkEmail,
			type : 'POST',
			dataType : "json",
			data : "&email="+$('#email').val()+"&how=register", 
			async : true,
			success : function(data){
				return data;
			},
			error: function(jqXHR, textStatus, errorThrown){alert("服务器没有返回数据，可能服务器忙，请重试"+errorThrown);},
			onError : "该邮箱已被注册！请更换",
			onWait : "正在对邮箱进行合法性校验，请稍候..."
		});
	$("#email_verify").formValidator({onShow:"收到邮件中的验证码",onFocus:"完成注册必须项",onCorrect:"输入正确"}).inputValidator({min:1,max:8,onError:"验证码错误,请确认"}).ajaxValidator({
			url : checkEmailCode,
			type : 'POST',
			dataType : "json",
			data : "&email="+$('#email').val()+"&email_verify="+$('#email_verify').val(), 
			async : true,
			success : function(data){
				return data;
			},
			error: function(jqXHR, textStatus, errorThrown){alert("服务器没有返回数据，可能服务器忙，请重试"+errorThrown);},
			onError : "邮箱验证码错误！请检查",
			onWait : "正在对邮箱验证码进行合法性校验，请稍候..."
		});
	$("#mobile").formValidator({onShow:"主要用于交易通知",onFocus:"11位数字，如“13812345678”",onCorrect:"谢谢你的合作",onEmpty:"该项为必填项"}).regexValidator({regExp:"mobile",dataType:"enum",onError:"你输入的手机号码格式不正确"}).ajaxValidator({
			url : checkMobile,
			type : 'POST',
			dataType : "json",
			data : "&mobile="+$('#mobile').val()+"&how=register", 
			async : true,
			success : function(data){
				return data;
			},
			error: function(jqXHR, textStatus, errorThrown){alert("服务器没有返回数据，可能服务器忙，请重试"+errorThrown);},
			onError : "手机号已被注册！请更换",
			onWait : "正在对手机号进行合法性校验，请稍候..."
		});
	$("#mobile_verify").formValidator({onShow:"收到手机中的验证码",onFocus:"完成注册必须项",onCorrect:"输入正确"}).inputValidator({min:1,max:8,onError:"验证码错误,请确认"}).ajaxValidator({
			url : checkMobileCode,
			type : 'POST',
			dataType : "json",
			data : "&mobile="+$('#mobile').val()+"&mobile_verify="+$('#mobile_verify').val(), 
			async : true,
			success : function(data){
				return data;
			},
			error: function(jqXHR, textStatus, errorThrown){alert("服务器没有返回数据，可能服务器忙，请重试"+errorThrown);},
			onError : "手机验证码错误！请检查",
			onWait : "正在对手机验证码进行合法性校验，请稍候..."
		});

	$("#pwd").formValidator({onShow:"请输入密码",onFocus:"至少6个字符",onCorrect:"密码合法"}).inputValidator({min:6,empty:{leftEmpty:false,rightEmpty:false,emptyError:"密码两边不能有空符号"},onError:"密码至少6个字符,请确认"});
	$("#pwded").formValidator({onShow:"输再次输入密码",onFocus:"至少6个字符",onCorrect:"密码一致"}).inputValidator({min:6,empty:{leftEmpty:false,rightEmpty:false,emptyError:"重复密码两边不能有空符号"},onError:"重复密码至少6个字符,请确认"}).compareValidator({desID:"pwd",operateor:"=",onError:"2次密码不一致,请确认"});
	$("#verify_code").formValidator({onShow:"请输入验证码",onFocus:"验证码不能为空",onCorrect:"输入正确"}).inputValidator({min:1,max:8,onError:"验证码错误,请确认"});
	// .ajaxValidator({
	// 		url : checkVerify,
	// 		type : 'POST',
	// 		dataType : "json",
	// 		data : "&verify_code="+$('#verify_code').val(), 
	// 		async : true,
	// 		success : function(data){
	// 			return data;
	// 		},
	// 		error: function(jqXHR, textStatus, errorThrown){alert("服务器没有返回数据，可能服务器忙，请重试"+errorThrown);},
	// 		onError : "验证码错误！请检查",
	// 		onWait : "正在对验证码进行合法性校验，请稍候..."
	// 	});
	$(":checkbox[name='isAgree']").formValidator({tipID:"isAgreeTip",onShow:"选择网站服务协议",onFocus:"必须同意网站服务协议",onCorrect:"已同意网站服务协议"}).inputValidator({min:1,onError:"必须同意网站服务协议"});
	// 表单验证】
    });
// 重新发送验证码
function time(o) {
    if (wait == 0) {
        o.attr("disabled", false);
        o.attr('value','重新发送');       
        wait = 60;
    } else {
        o.attr("disabled", true);
        o.attr('value','重新发送(' + wait + ')');
        wait--;
        setTimeout(function() {
            time(o)
        },
        1000)
    }
}
</script>
</html>
